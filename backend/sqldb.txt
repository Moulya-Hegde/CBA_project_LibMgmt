-- Database will be created by Docker environment variables
USE libmgmt;

-- Books table
CREATE TABLE books (
  id INT AUTO_INCREMENT PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  author VARCHAR(255),
  genre VARCHAR(100),
  publicationDate DATE,
  description TEXT
);

-- Copies table
CREATE TABLE copies (
  id INT AUTO_INCREMENT PRIMARY KEY,
  bookId INT,
  copyId VARCHAR(50) UNIQUE,
  available BOOLEAN DEFAULT TRUE,
  FOREIGN KEY (bookId) REFERENCES books(id) ON DELETE CASCADE
);

-- Users table
CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  username VARCHAR(100) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  age INT,
  college VARCHAR(255),
  email VARCHAR(255) UNIQUE,
  role VARCHAR(50) DEFAULT 'user',
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Issued books table
CREATE TABLE issuedBooks (
  id INT AUTO_INCREMENT PRIMARY KEY,
  userId INT,
  bookId INT,
  copyId VARCHAR(50),
  issueDate DATE,
  returnDate DATE,
  FOREIGN KEY (userId) REFERENCES users(id),
  FOREIGN KEY (bookId) REFERENCES books(id)
);

-- Insert only the 2 essential users for login (as shown on login page)
INSERT INTO users (name, username, password, age, college, email, role) VALUES
('User One', 'user1', 'user1', 22, 'Demo College', 'user1@example.com', 'user'),
('User Two', 'user2', 'user2', 24, 'Demo College', 'user2@example.com', 'admin');